<h2>Add Finding to Project: {{ project.project_name }}</h2>

<form method="post" id="finding-form">
    {% csrf_token %}

    <p>{{ form.vkb.label_tag }} {{ form.vkb }}</p>
    <p>{{ form.vkb_category.label_tag }} {{ form.vkb_category }}</p>
    <p>{{ form.title.label_tag }} {{ form.title }}</p>
    <p>{{ form.description.label_tag }} {{ form.description }}</p>
    <p>{{ form.impact.label_tag }} {{ form.impact }}</p>
    <p>{{ form.recommendation.label_tag }} {{ form.recommendation }}</p>
    <p>{{ form.affected.label_tag }} {{ form.affected }}</p>
    <p>{{ form.severity.label_tag }} {{ form.severity }}</p>
    <p>{{ form.score.label_tag }} {{ form.score }}</p>
    <p>{{ form.poc.label_tag }} {{ form.poc }}</p>
    <p>{{ form.status.label_tag }} {{ form.status }}</p>
    <p>{{ form.save_to_vkb }} {{ form.save_to_vkb.label }}</p>

    <button type="submit">Save</button>
</form>

<script>
document.getElementById('id_vkb').addEventListener('change', function () {
    const vkbId = this.value;
    if (!vkbId) {
        // kosong berarti pilih "Custom" â†’ kosongkan field (opsional)
        return;
    }

    fetch(`/vkb/api/${vkbId}/`)
        .then(res => res.json())
        .then(data => {
            document.getElementById('id_title').value = data.title;
            document.getElementById('id_description').value = data.description;
            document.getElementById('id_impact').value = data.impact;
            document.getElementById('id_recommendation').value = data.recommendation;
            const categorySelect = document.getElementById('id_vkb_category');
            if (categorySelect) {
                for (let option of categorySelect.options) {
                    if (option.value === data.category) {
                        option.selected = true;
                        break;
                    }
                }
            }
        });
});
</script>
